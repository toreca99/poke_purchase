<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>ã‚«ãƒ¼ãƒ‰ä¸€è¦§</title>
<style>
:root {
  /* ================================
     ã‚«ãƒ©ãƒ¼ãƒ»ãƒ•ã‚©ãƒ³ãƒˆãƒ»é–“éš”ã®å¤‰æ•°
     ================================ */
  --color-primary: #f88379;       /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ï¼ˆãƒœã‚¿ãƒ³ãªã©ï¼‰ */
  --color-gray-light: #f9f9f9;    /* ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ */
  --color-gray-border: #ccc;      /* ã‚«ãƒ¼ãƒ‰å¢ƒç•Œç·š */
  --font-size-base: 12px; /* åŸºæœ¬æ–‡å­—ã‚µã‚¤ã‚ºã‚’å°ã•ã‚ã« */
  --font-size-small: 11px;
  --font-size-xsmall: 9px;
  --card-border-radius: 4px;      /* ã‚«ãƒ¼ãƒ‰è§’ä¸¸ */
  --spacing-xs: 2px;
  --spacing-sm: 4px;
  --spacing-md: 8px;
}

/* ================================
   ãƒšãƒ¼ã‚¸å…¨ä½“
   ================================ */
body {
  font-family: sans-serif;
  padding: 10px;
  background: #fff;
}
h1 {
  font-size: 22px;       /* æ–‡å­—ã‚µã‚¤ã‚ºã‚’å°‘ã—å¤§ãã */
  font-weight: bold;
  text-align: center;    /* ä¸­å¤®æƒãˆ */
  margin-bottom: 6px;   /* ä¸‹ã®ä½™ç™½ã‚‚å°‘ã—åºƒã’ã‚‹ */
}

.notice {
  font-size: 10px;   /* å°ã•ã */
  line-height: 1.2;  /* è¡Œé–“ã‚‚å°‘ã—è©°ã‚ã‚‹ */
  color: #d00;
  margin-bottom: 6px; /* å°‘ã—ä½™ç™½ã‚‚æ¸›ã‚‰ã™ */
}


/* ================================
   ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆæ¤œç´¢ãƒ»ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ»ãƒœã‚¿ãƒ³ï¼‰
   ================================ */
.controls { 
  display: flex; 
  flex-direction: column; 
  gap: 12px; 
  margin-bottom: 10px; 
}
.search-wrapper { 
  display: flex; 
  width: 100%; 
  margin-bottom: 8px; 
}
#searchInput { 
  flex: 1; 
  padding: 8px 10px;  /* ç¸¦æ¨ªã¨ã‚‚å°‘ã—å¤§ãã‚ */
  font-size: 14px;    /* æ–‡å­—ã‚‚å¤§ããè¦‹ã‚„ã™ã */
  border: 1px solid var(--color-gray-border); 
  border-radius: 4px; 
}

.checkbox-group { 
  margin-bottom: 4px;  /* ä»¥å‰ã¯16pxãªã©ã€å¿…è¦ã«å¿œã˜ã¦èª¿æ•´ */
}
.checkbox-group strong { 
  display: block; 
  margin-bottom: 1px;  /* è¦ªã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒ©ãƒ™ãƒ«ã®é–“éš”ã‚’ç¸®ã‚ã‚‹ */
}
.checkbox-group label {
  display: inline-flex;
  align-items: center;
  margin-right: 4px;
  padding-left: 4px;
  cursor: pointer;
  line-height: 1.1; /* è¡Œé–“ã‚’è©°ã‚ã‚‹ */
}
.checkbox-group input:checked + span {
  background-color: #f0c0c0;
  padding: 1px 2px;
  border-radius: 2px;
}

/* ãƒœã‚¿ãƒ³ */
.buttons-wrapper { 
  display: flex; 
  gap: 8px; 
  width: 100%; 
  margin-top: 6px; 
}
.buttons-wrapper button {
  flex: 1;
  padding: 6px;
  font-size: 12px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  background-color: #666;
  color: white;
  text-align: center;
}
.buttons-wrapper button.active { 
  background-color: var(--color-primary); 
}

/* ================================
   ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰
   ================================ */
.card-grid { 
  display: grid; 
  gap: 4px; 
}

/* ã‚¹ãƒãƒ›è¡¨ç¤ºï¼ˆ767pxä»¥ä¸‹ï¼‰ */
@media (max-width: 767px) { 
  .card-grid:not(.no-image) { 
    grid-template-columns: repeat(4, 1fr); 
  } 
}

/* PCè¡¨ç¤ºï¼ˆ768pxä»¥ä¸Šï¼‰ */
@media (min-width: 768px) { 
  .card-grid { 
    grid-template-columns: repeat(4, 1fr); 
  } 
}

/* ================================
   ã‚«ãƒ¼ãƒ‰1æš
   ================================ */
.card {
  border: 1px solid var(--color-gray-border);
  border-radius: var(--card-border-radius);
  padding: 2px;
  text-align: center;
  background-color: var(--color-gray-light);
  font-size: var(--font-size-xsmall);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-height: 210px;
}

/* ã‚«ãƒ¼ãƒ‰ç”»åƒ */
.card img {
  width: 100%;
  height: auto;
  max-height: 80px;
  object-fit: contain;
  margin-bottom: 4px;
}

/* ã‚«ãƒ¼ãƒ‰å */
.card-name {
  font-weight: bold;
  margin: 2px 0;
  font-size: 7px;
  white-space: normal;
  cursor: pointer;
}

/* ã‚«ãƒ¼ãƒ‰å†…ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ */
.card-texts {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  flex-grow: 1;
}

/* å‹Ÿé›†æšæ•° */
.card-quantity {
  font-size: 9px;
  font-weight: bold;
  color: #a66b6f;
}

/* æ³¨æ„æ›¸ã */
.card-note {
  font-size: 8px;
  color: #555;
  margin-top: 2px;
}

/* ä¾¡æ ¼ */
.card-price {
  font-weight: bold;
  font-size: 12px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-top: auto;
}

/* ä¾¡æ ¼è‰²æŒ‡å®š */
.price-store { color: #e53935 !important; font-weight: bold; }
.price-mail  { color: #43a047 !important; font-weight: bold; }

/* ã‚°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆå‹Ÿé›†0æšãªã©ï¼‰ */
.gray-out { opacity: 0.9; filter: grayscale(100%); pointer-events: none; }

/* ã•ã‚‰ã«èª­ã¿è¾¼ã‚€ãƒœã‚¿ãƒ³ */
#loadMoreButton {
  margin-top: 30px;
  width: 100%;
  padding: 36px 12px;
  font-size: 15px;
  border: none;
  background-color: var(--color-primary);
  color: white;
  border-radius: var(--card-border-radius);
  cursor: pointer;
}

/* ç”»åƒèª­ã¿è¾¼ã¿æ™‚ã®ã¼ã‹ã— */
img.lazy { filter: blur(2px); transition: filter 0.3s; }
img.lazy.loaded { filter: none; }

/* ================================
   ç”»åƒOFFæ™‚ã®ã‚«ãƒ¼ãƒ‰ï¼ˆå°ã•ã‚è¡¨ç¤ºï¼‰
   ================================ */

/* ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰å…¨ä½“ */
.card-grid.no-image { 
  display: flex;               /* ç¸¦æ–¹å‘ã«ä¸¦ã¹ã‚‹ */
  flex-direction: column;     
  gap: 4px;                    /* ã‚«ãƒ¼ãƒ‰é–“ã®éš™é–“ã‚’å°‘ã—å°ã•ã */
  overflow-x: hidden;          /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ */
  padding: 2px;                /* å†…å´ä½™ç™½ã‚’å°‘ã—ç¸®å° */
}

/* å„ã‚«ãƒ¼ãƒ‰ */
.card.no-image { 
  display: flex;              
  flex-wrap: wrap;             /* è¦ç´ ã‚’æŠ˜ã‚Šè¿”ã—å¯èƒ½ */
  align-items: center;         /* å‚ç›´ä¸­å¤®æƒãˆ */
  justify-content: space-between; /* å·¦å³ã«å‡ç­‰é…ç½® */
  min-height: auto;           
  padding: 4px 6px;            /* å†…å´ä½™ç™½ã‚’å°‘ã—ç¸®å° */
  gap: 6px;                    /* è¦ç´ é–“ã®éš™é–“ */
  border-radius: 4px;          /* è§’ä¸¸ã‚‚å°‘ã—å°ã•ã‚ */
  font-size: 0.9em;            /* å…¨ä½“ã‚’å°‘ã—ç¸®å° */
  background-color: #f9f9f9;  
}

/* ç”»åƒã¯éè¡¨ç¤º */
.card.no-image img { display: none; }

/* ã‚«ãƒ¼ãƒ‰å */
.card.no-image .card-name { 
  font-size: 12px;   /* å°ã•ã‚è¡¨ç¤º */
  font-weight: bold; 
  flex: 1 1 auto;    
  min-width: 0;      
  margin: 0;
  white-space: nowrap;
}

/* å‹Ÿé›†æšæ•° */
.card.no-image .card-quantity { 
  font-size: 13px;   /* å°‘ã—å°ã•ã‚ */
  font-weight: bold; 
  flex: 0 0 auto;    
  margin: 0;
  white-space: nowrap;
  color: #a66b6f;
}

/* ä¾¡æ ¼è¡¨ç¤º */
.card.no-image .card-price { 
  font-size: 14px;   /* è¦‹ã‚„ã™ãå°‘ã—å¤§ãã‚ */
  flex: 1 1 auto;    
  min-width: 0;      
  white-space: nowrap;        
  overflow: hidden;           
  text-overflow: ellipsis;    
  margin: 0;
}

/* ä¾¡æ ¼è‰²ä»˜ã‘ */
.card-price .price-store-inline { 
  color: #e53935; 
  font-weight: bold; 
}
.card-price .price-mail-inline { 
  color: #43a047; 
  font-weight: bold; 
}

/* ================================
   ç”»åƒOFFæ™‚ã®èª¿æ•´å®Œäº† ä¸‹è¨˜ã‚¹ãƒãƒ›æ™‚ã®è¨­å®šå®Œäº†
   ================================ */

@media (max-width: 767px) {
  /* âœ… ã‚«ãƒ¼ãƒ‰é–“ã®éš™é–“ã‚’è©°ã‚ã‚‹ï¼ˆä¸€è¦§æ€§UPï¼‰ */
  .card-grid {
    gap: 4px; /* â†’ å°ã•ã‚ã€‚æ•°å­—ã‚’å°ã•ãã™ã‚‹ã»ã©å¯†åº¦UP */
  }

  /* âœ… ã‚«ãƒ¼ãƒ‰ã®å†…å´ä½™ç™½ã‚‚æœ€å°é™ã« */
  .card {
    padding: 2px;      /* â†’ 4px ã‹ã‚‰ã•ã‚‰ã«å‰Šæ¸› */
    min-height: 180px; /* â†’ é«˜ã•ã‚‚åœ§ç¸®ï¼ˆå¤šãè¦‹ã›ã‚‹ï¼‰ */
  }

  /* âœ… æ–‡å­—ã‚µã‚¤ã‚ºã‚’å…¨ä½“çš„ã«æŠ‘ãˆã‚‹ */
  .card-name {
    font-size: 8px;
  }
  .card-quantity {
    font-size: 9px;
  }
  .card-price {
    font-size: 10px;
  }
  .card-note {
    font-size: 7px;
    line-height: 1.1; /* è¡Œé–“ã‚‚è©°ã‚ã‚‹ */
  }

  /* âœ… ãƒœã‚¿ãƒ³é¡ã¯æœ€å°é™ã®ã‚µã‚¤ã‚ºã« */
  .buttons-wrapper button {
    font-size: 10px;  /* â†’ å°ã•ã */
    padding: 4px 3px; /* â†’ ã‚¿ãƒƒãƒ—é ˜åŸŸã‚’å‰Šæ¸› */
  }

  /* âœ… ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ©ãƒ™ãƒ«ã‚‚è©°ã‚ã‚‹ */
  .checkbox-group label {
    line-height: 1.1;
    margin-right: 4px;
    font-size: 10px;
  }
  .checkbox-group input {
    transform: scale(0.9); /* â†’ å°ã•ã‚ã« */
    margin-right: 2px;
  }

  .checkbox-group {
    margin-bottom: 1px; /* ã‚¹ãƒãƒ›ã§ã¯ã•ã‚‰ã«ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
  }

  .checkbox-group strong {
    margin-bottom: 1px;
  }
}


  /* âœ… ã€Œã•ã‚‰ã«èª­ã¿è¾¼ã‚€ã€ãƒœã‚¿ãƒ³ã‚‚åœ§ç¸® */
  #loadMoreButton {
    font-size: 12px;
    padding: 12px 6px;
  }

  /* âœ… ç”»åƒã‚‚å°‘ã—å°ã•ã‚ï¼ˆç¸¦ã‚’å‰Šã‚‹ï¼‰ */
  .card img {
    max-height: 90px; /* â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ120pxã‹ã‚‰ç¸®å° */
  }

  /* ã“ã“ã‹ã‚‰è¿½åŠ ï¼šç”»åƒOFFæ™‚ã®æ–‡å­—ã‚µã‚¤ã‚ºèª¿æ•´ */
  .card.no-image .card-name { font-size: 8px; }
  .card.no-image .card-quantity { font-size: 9px; }
  .card.no-image .card-price { font-size: 10px; }
}


</style>
</head>
<body>

<h1>ã€ãƒã‚±ãƒ¢ãƒ³ã‚«ãƒ¼ãƒ‰è²·å–è¡¨(éƒµé€ã‚‚å…±é€š)ã€‘</h1>

<div class="notice">
â€»ãƒ‡ãƒ¼ã‚¿å®¹é‡ã®éƒ½åˆä¸Šã€èª­ã¿è¾¼ã¿ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
â€»ä¾¡æ ¼ã‚„å‹Ÿé›†æšæ•°ã®æ›´æ–°ã«ãƒ©ã‚°ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
â€»ç›¸å ´ã®å¤‰å‹•ã‚„åœ¨åº«çŠ¶æ³ã«ã‚ˆã£ã¦ã€äºˆå‘Šãªãå‹Ÿé›†æšæ•°ã‚„ä¾¡æ ¼ãŒå¤‰å‹•ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
â€»å‹Ÿé›†æšæ•°ãŒ0æšã®å ´åˆã§ã‚‚è³¼å…¥ã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
â€»åŸºæœ¬çš„ã«ç”»åƒã®ã‚«ãƒ¼ãƒ‰ã¯ã€PSA10ã€‘ã®ä¾¡æ ¼ã§ã”ã–ã„ã¾ã™ã€‚æœªé–‹å°å•†å“ã¯ã€æœªé–‹å°ã€‘ã¨è¨˜è¼‰ã®ã‚ã‚‹å•†å“ã®ä¾¡æ ¼ã§ã™ã€‚
</div>

<div class="controls">

  <div class="checkbox-group">
    <strong>ãƒã‚±ãƒ¢ãƒ³ç¨®æ—</strong>
    <label><input type="checkbox" value="ãƒ”ã‚«ãƒãƒ¥ã‚¦"><span>ãƒ”ã‚«ãƒãƒ¥ã‚¦ç³»çµ±</span></label>
    <label><input type="checkbox" value="ãƒªã‚¶ãƒ¼ãƒ‰ãƒ³"><span>ãƒªã‚¶ãƒ¼ãƒ‰ãƒ³ç³»çµ±</span></label>
    <label><input type="checkbox" value="ãƒ–ã‚¤ã‚º"><span>ãƒ–ã‚¤ã‚ºç³»çµ±</span></label>
    <label><input type="checkbox" value="ãƒŸãƒ¥ã‚¦"><span>ãƒŸãƒ¥ã‚¦ç³»çµ±</span></label>
    <label><input type="checkbox" value="ã‚²ãƒ³ã‚¬ãƒ¼"><span>ã‚²ãƒ³ã‚¬ãƒ¼ç³»çµ±</span></label>
    <label><input type="checkbox" value="ãƒ¬ãƒƒã‚¯ã‚¦ã‚¶"><span>ãƒ¬ãƒƒã‚¯ã‚¦ã‚¶ç³»çµ±</span></label>
  </div>
  <div class="checkbox-group">
    <strong>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</strong>
    <label><input type="checkbox" value="ã‚µãƒãƒ¼ãƒˆ"><span>ã‚µãƒãƒ¼ãƒˆç³»çµ±</span></label>
    <label><input type="checkbox" value="ãƒªãƒ¼ãƒªã‚¨"><span>ãƒªãƒ¼ãƒªã‚¨ç³»çµ±</span></label>
    <label><input type="checkbox" value="ã‚¢ã‚»ãƒ­ãƒ©"><span>ã‚¢ã‚»ãƒ­ãƒ©ç³»çµ±</span></label>
    <label><input type="checkbox" value="ãƒãƒªã‚£"><span>ãƒãƒªã‚£ç³»çµ±</span></label>
    <label><input type="checkbox" value="ãƒŠãƒ³ã‚¸ãƒ£ãƒ¢"><span>ãƒŠãƒ³ã‚¸ãƒ£ãƒ¢ç³»çµ±</span></label>
  </div>
  <div class="checkbox-group">
    <strong>ãƒ¬ã‚¢ãƒ»ç‰¹æ®Š</strong>
    <label><input type="checkbox" value="ãƒ¡ã‚¬"><span>ãƒ¡ã‚¬ç³»çµ±</span></label>
    <label><input type="checkbox" value="ex"><span>exãƒ»EXç³»çµ±</span></label>
    <label><input type="checkbox" value="AR"><span>ARãƒ»CHRç³»çµ±</span></label>
    <label><input type="checkbox" value="V"><span>Vãƒ»VMAXãƒ»VSTARç³»çµ±</span></label>
    <label><input type="checkbox" value="GX"><span>GXç³»çµ±</span></label>
    <label><input type="checkbox" value="nagaba"><span>nagabaç³»çµ±</span></label>
    <label><input type="checkbox" value="ãƒã‚¹ãƒœ"><span>ãƒã‚¹ã‚¿ãƒ¼ãƒœãƒ¼ãƒ«ç³»çµ±</span></label>
    <label><input type="checkbox" value="æµ·å¤–"><span>æµ·å¤–ç³»çµ±</span></label>
    <label><input type="checkbox" value="th"><span>å‘¨å¹´ç³»çµ±</span></label>
    <label><input type="checkbox" value="ãƒãƒƒã‚¯"><span>ãƒãƒƒã‚¯ãƒ—ãƒ­ãƒ¢ç³»çµ±</span></label>
  </div>

  <div class="search-wrapper">
    <input type="text" id="searchInput" placeholder="ã‚«ãƒ¼ãƒ‰åã‚„å‹ç•ªã§æ¤œç´¢ï¼ˆã²ã‚‰ãŒãªæ¤œç´¢å¯¾å¿œï¼‰" aria-label="ã‚«ãƒ¼ãƒ‰æ¤œç´¢" />
  </div>


  <div class="buttons-wrapper">
    <button id="resetButton">æ¤œç´¢æ¡ä»¶ã‚’<br>ãƒªã‚»ãƒƒãƒˆ</button>
    <button class="sort-btn" data-sort="price">ä¾¡æ ¼<br>ï¼ˆé«˜ã„é †ï¼‰</button>
    <button class="sort-btn" data-sort="priceLow">ä¾¡æ ¼<br>ï¼ˆå®‰ã„é †ï¼‰</button>
    <button id="toggleImageButton">ç”»åƒON/OFF</button>
  </div>
</div>

<div class="card-grid" id="cardList"></div>
<button id="loadMoreButton">ã“ã¡ã‚‰ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ã•ã‚‰ã«ã‚«ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚€</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTgSjXDetFkCm904ILmhH9UB24MbFrPV0TNdOKFJI_jxr7hvDy8hymSpj4ZX34_4ICBmqHa-QAT8qSo/pub?gid=1393270336&single=true&output=csv';

let cards = [];
let filteredCards = [];
let currentPage = 0;
const cardsPerPage = 96;
let showImages = true;

// ã‚«ã‚¿ã‚«ãƒŠ â†’ ã²ã‚‰ãŒãª
function kataToHira(str){
  return str.replace(/[\u30a1-\u30f6]/g, match => String.fromCharCode(match.charCodeAt(0)-0x60));
}

// è‹±æ•°å­—å…¨è§’ â†’ åŠè§’ã€å°æ–‡å­—åŒ–ã€ã²ã‚‰ãŒãªçµ±ä¸€ã€æ¼¢å­—ã¯æ®‹ã™
function normalizeLatin(str){
  return str
    .toLowerCase()
    // å…¨è§’è‹±æ•°å­— â†’ åŠè§’
    .replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0))
    // å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ â†’ åŠè§’
    .replace(/\u3000/g, ' ')
    // ã²ã‚‰ãŒãªâ‡”ã‚«ã‚¿ã‚«ãƒŠçµ±ä¸€ï¼ˆã‚«ã‚¿ã‚«ãƒŠã¯ã²ã‚‰ãŒãªã«å¤‰æ›æ¸ˆã¿ï¼‰
    .replace(/[\u30a1-\u30f6]/g, s => String.fromCharCode(s.charCodeAt(0) - 0x60))
    // è¨˜å·é¡ã¯å‰Šé™¤ï¼ˆæ¼¢å­—ãƒ»ã²ã‚‰ãŒãªãƒ»è‹±æ•°å­—ã¯æ®‹ã™ï¼‰
    .replace(/[^a-z0-9ã-ã‚“ä¸€-é¾¯]/g,'');
}

// å…¥åŠ›æ–‡å­—åˆ—ã‚’ã‚¹ãƒšãƒ¼ã‚¹ãƒ»ã‚«ãƒ³ãƒãƒ»ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã§åˆ†å‰²ã—ã¦æ­£è¦åŒ–
function splitKeywords(str){
  return str.split(/[\s,ãƒ»ï¼]+/)
            .map(s => normalizeLatin(kataToHira(s)))
            .filter(Boolean);
}

// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§é¸æŠã•ã‚ŒãŸå€¤ã‚’å–å¾—
function getCheckedValues(){
  const checked = document.querySelectorAll('.checkbox-group input:checked');
  return Array.from(checked).map(cb => cb.value);
}

function applyFilterSort(sortValueFromBtn){
  const keyword = document.getElementById('searchInput').value.trim();
  const keywords = splitKeywords(keyword);
  const checkedValues = getCheckedValues();
  let sortValue = sortValueFromBtn || document.querySelector('.sort-btn.active')?.dataset.sort || 'price';

  filteredCards = cards.filter(card => {
    // ğŸ”¹ã‚«ãƒ¼ãƒ‰åã§æ¤œç´¢åˆ¤å®š
    const target = normalizeLatin(kataToHira(card["ã‚«ãƒ¼ãƒ‰å å‹ç•ª ãƒ¬ã‚¢ãƒªãƒ†ã‚£"]||""));
    const keywordMatch = keywords.every(k => target.includes(k));

// ğŸ”¹åˆ†é¡ã§ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹åˆ¤å®šï¼ˆåˆ†é¡1 ã¾ãŸã¯ åˆ†é¡2 ã«å«ã¾ã‚Œã‚‹ã‹ã§åˆ¤å®šï¼‰
const classification1 = normalizeLatin(kataToHira(card["åˆ†é¡1"] || ""));
const classification2 = normalizeLatin(kataToHira(card["åˆ†é¡2"] || ""));
const checkboxMatch =
  checkedValues.length===0 ||
  checkedValues.some(val => classification1.includes(normalizeLatin(kataToHira(val))) ||
                            classification2.includes(normalizeLatin(kataToHira(val))));

    return keywordMatch && checkboxMatch;
  });

  if(sortValue==='price'){
    filteredCards.sort((a,b)=> 
      (Number((b["åº—é ­ä¾¡æ ¼"]||'0').replace(/[Â¥,\s]/g,''))||0) -
      (Number((a["åº—é ­ä¾¡æ ¼"]||'0').replace(/[Â¥,\s]/g,''))||0)
    );
  } else if(sortValue==='priceLow'){
    filteredCards.sort((a,b)=> 
      (Number((a["åº—é ­ä¾¡æ ¼"]||'0').replace(/[Â¥,\s]/g,''))||0) -
      (Number((b["åº—é ­ä¾¡æ ¼"]||'0').replace(/[Â¥,\s]/g,''))||0)
    );
  }

  currentPage=0;
  displayNextPage();
}


async function fetchCsvData(){
  document.getElementById('cardList').textContent='èª­ã¿è¾¼ã¿ä¸­.....';
  try{
    const res = await fetch(csvUrl);
    const text = await res.text();
    const parsed = Papa.parse(text,{header:true, skipEmptyLines:true});
cards = parsed.data.map(card=>({
  "ã‚«ãƒ¼ãƒ‰å å‹ç•ª ãƒ¬ã‚¢ãƒªãƒ†ã‚£": card["ã‚«ãƒ¼ãƒ‰å å‹ç•ª ãƒ¬ã‚¢ãƒªãƒ†ã‚£"],
  "åˆ†é¡1": card["åˆ†é¡1"],   // â† æ–°ã—ãè¿½åŠ 
  "åˆ†é¡2": card["åˆ†é¡2"],   // â† æ–°ã—ãè¿½åŠ 
  "å‹Ÿé›†æšæ•°": card["å‹Ÿé›†æšæ•°"],
  "åº—é ­ä¾¡æ ¼": card["åº—é ­ä¾¡æ ¼"],
  "æœ€ä½ä¾¡æ ¼": card["æœ€ä½ä¾¡æ ¼"],
  "ç”»åƒURL": card["ç”»åƒURL"],
  "ã‚°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç™ºå‹•æ™‚å°‚ç”¨": card["ã‚°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç™ºå‹•æ™‚å°‚ç”¨"]
}));

    applyFilterSort();
  } catch(e){ console.error(e); document.getElementById('cardList').textContent='ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'; }
}

const observer = new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){
      const img=entry.target;
      if(img.dataset.src) { img.src=img.dataset.src; img.classList.add('loaded'); img.removeAttribute('data-src'); }
      observer.unobserve(img);
    }
  });
});

function displayNextPage(){
  const start=currentPage*cardsPerPage, end=start+cardsPerPage;
  const cardsToShow = filteredCards.slice(start,end);
  if(currentPage===0) document.getElementById('cardList').innerHTML='';

  const cardGrid = document.getElementById('cardList');
  cardsToShow.forEach(card=>{
    const isZero=(card["å‹Ÿé›†æšæ•°"]||"").trim()==="0æšå‹Ÿé›†ä¸­";
    const grayClass=isZero?'gray-out':'';
    const normalPrice=Number((card["åº—é ­ä¾¡æ ¼"]||'0').replace(/[Â¥,\s]/g,''))||0;
    const foilPrice=Number((card["æœ€ä½ä¾¡æ ¼"]||'0').replace(/[Â¥,\s]/g,''))||0;
const priceDisplay = showImages
  ? isZero ? (card["ã‚°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç™ºå‹•æ™‚å°‚ç”¨"]||'åº—é ­ã§ç¢ºèª') 
  : `<span class="price-store">åº—é ­è²·å–ä¾¡æ ¼</span><br><span class="price-store">Â¥${normalPrice.toLocaleString()}</span><br><span class="price-mail">æœ€ä½è²·å–ä¾¡æ ¼</span><br><span class="price-mail">Â¥${foilPrice.toLocaleString()}</span>`
  : isZero ? (card["ã‚°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç™ºå‹•æ™‚å°‚ç”¨"]||'åº—é ­ã§ç¢ºèª') 
  : `<span class="price-store-inline">åº—é ­è²·å–ä¾¡æ ¼ Â¥${normalPrice.toLocaleString()}</span> / <span class="price-mail-inline">æœ€ä½è²·å–ä¾¡æ ¼ Â¥${foilPrice.toLocaleString()}</span>`;


    const div = document.createElement('div');
    div.className = `card ${grayClass} ${!showImages ? 'no-image':''}`;
    div.innerHTML = `
      <img data-src="${card.ç”»åƒURL}" loading="lazy" alt="${card["ã‚«ãƒ¼ãƒ‰å å‹ç•ª ãƒ¬ã‚¢ãƒªãƒ†ã‚£"]}" class="lazy"/>
      <div class="card-name">${card["ã‚«ãƒ¼ãƒ‰å å‹ç•ª ãƒ¬ã‚¢ãƒªãƒ†ã‚£"]}</div>
      <div class="card-texts">
        <div class="card-price">${priceDisplay}</div>
        <div class="card-quantity">æœ¬æ—¥${isZero?'<br>æº€é¡ã¯çµ‚äº†':(card["å‹Ÿé›†æšæ•°"]||'-')}</div>
      </div>
    `;
    cardGrid.appendChild(div);
    const img = div.querySelector('img.lazy');
    if(img) observer.observe(img);
  });

  if(showImages){ cardGrid.classList.remove('no-image'); } else { cardGrid.classList.add('no-image'); }
  currentPage++;
  document.getElementById('loadMoreButton').style.display=(end>=filteredCards.length)?'none':'block';
}

// ã‚¤ãƒ™ãƒ³ãƒˆ 
document.getElementById('loadMoreButton').addEventListener('click', displayNextPage);

document.getElementById('resetButton').addEventListener('click', () => {
  document.getElementById('searchInput').value = '';
  document.querySelectorAll('.checkbox-group input').forEach(cb => cb.checked = false);
  document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelector('.sort-btn[data-sort="price"]').classList.add('active');
  applyFilterSort('price');
});

document.getElementById('searchInput').addEventListener('input', () => {
  // æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›æ™‚ â†’ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã™ã¹ã¦ã‚ªãƒ•
  document.querySelectorAll('.checkbox-group input').forEach(cb => cb.checked = false);
  applyFilterSort();
});

// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹æ“ä½œæ™‚ â†’ æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢
document.querySelectorAll('.checkbox-group input').forEach(cb =>
  cb.addEventListener('change', () => {
    if (cb.checked) {
      // è‡ªåˆ†ä»¥å¤–ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™
      document.querySelectorAll('.checkbox-group input').forEach(other => {
        if (other !== cb) other.checked = false;
      });
    }
    // ï¼ˆcb.checked ãŒ false ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„ â†’ å…¨éƒ¨æœªé¸æŠã‚‚OKï¼‰
    document.getElementById('searchInput').value = '';
    applyFilterSort();
  })
);


document.querySelectorAll('.sort-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.sort-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    applyFilterSort(btn.dataset.sort);
  });
});

// ç”»åƒON/OFF
document.getElementById('toggleImageButton').addEventListener('click',()=>{
  showImages = !showImages;
  currentPage=0;
  displayNextPage();
});

fetchCsvData();
</script>
</body>
</html>
